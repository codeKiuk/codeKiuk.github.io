{"componentChunkName":"component---src-templates-blog-post-js","path":"/2023-02-28-url-search-params/","result":{"data":{"site":{"siteMetadata":{"title":"Juvantia"}},"markdownRemark":{"id":"82ca94aa-233e-5d93-b9b8-34b7a2372dff","excerpt":"react-query로 client state와 server state의 분리 를 통한 source of truth를 실현한 Tanner Linsely가 만든 다른 오픈소스 프로젝트인 tanstack-router를 우연히 접했었는데,\ntanstack-router에서 강조한 url…","html":"<blockquote>\n<p><strong>react-query</strong>로 <em>client state와 server state의 분리</em> 를 통한 <strong>source of truth</strong>를 실현한 <a href=\"https://github.com/tannerlinsley\">Tanner Linsely</a>가 만든 다른 오픈소스 프로젝트인 <strong>tanstack-router</strong>를 우연히 접했었는데,\n<strong>tanstack-router</strong>에서 강조한 url search params를 활용한 data fetching orchestration을 간단하게 적용해봤다. (물론 크게 복잡한 작업은 아니어서 tanstack-router 를 적용하진 않았고 plain하게 URL SearchParams를 조작했다.)</p>\n</blockquote>\n<p><strong>참조</strong></p>\n<p>특정 url에서 볼 수 있는 ?page=3, ?filter=ascending 등 의 url search params는 url search params가 <strong>전역 상태</strong>와 같은 역할을 할 수 있고, 아래와 같은 이점도 존재한다.</p>\n<ol>\n<li>페이지 리로드시에도 동일한 상태를 보여준다.</li>\n<li>링크만 동일하다면 누구에게나 동일한 상태를 보여준다.</li>\n<li>네비게이션간에 상태 저장이 쉽다.</li>\n<li>source of truth 원칙을 지키기 쉽다.</li>\n</ol>\n<ul>\n<li>tanstack-router의 <a href=\"https://tanstack.com/router/v1/docs/guide/search-params\">URL SearchParams를 통한 상태 저장에 관한 글</a></li>\n</ul>\n<hr>\n<p>아무튼간 배경부터..</p>\n<h3>스프린트의 시작</h3>\n<p>변호사 프로필 페이지를 개선하기 위한 스프린트 플래닝을 할 때 기존에 Vue2로 되어 있는 코드베이스를 Next로 마이그레이션하는 작업도 포함해서 개발하자고 얘기가 되었다.</p>\n<p>그래서 아래와 같은 순서로 개발이 진행되었다.</p>\n<ol>\n<li>변경된 레이아웃 작업</li>\n<li>변경된 UI 작업</li>\n<li>기존 기능 동일하게 이식하는 작업</li>\n<li>추가된 기능 작업</li>\n<li>기존 이벤트 동일하게 이식하는 작업</li>\n</ol>\n<p>이 중 4번. 추가된 기능 작업을 할 때 URL SearchParams를 활용해보기로 했다.</p>\n<h3>언제 활용했나!</h3>\n<p>바로 아래 섹션에서 url search param을 적극 활용하면 react-query를 사용할 때 굉장히 편할 것 같다는 생각을 했다.</p>\n<p>현재 유저가 보고있는 변호사 프로필 페이지의 변호사 회원이 쓴 글을 검색할 수 있는 섹션이다.</p>\n<p>범죄분야, 검색어, 변호사 회원이 작성한 글의 타입 (상담, 해결) 에 따라 상이한 검색 결과를 보여준다.</p>\n<p>즉, 리스트 데이터를 fetch할 때 <strong>여러가지 조건</strong>을 적용하는데 이 조건들을 유려하게 핸들링했어야 했다.</p>\n<p>그렇다면 그 여러가지 조건을 조작할 수 있는 영역은 어떤 것들이 있나??</p>\n<ul>\n<li>범죄분야를 선택할 수 있는 Select Box 영역</li>\n<li>검색어 input field</li>\n<li>변호사 회원이 작성한 글의 타입을 변경할 수 있는 (전체, 상담사례, 해결사례로 구성되어 있는) Tab</li>\n<li>Pagination</li>\n</ul>\n<p>이렇게 4가지 조건이 합쳐져 리스트를 불러오게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a5eb17d0266b2a8a0a236acc6165474/5bb8b/contents-section.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 158.22784810126583%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAENElEQVR42o1Wa4/bNhC8//93igLXFmjSBmjuS9MWTe7a+qUn9Rb1okVJlCbYlWTL1ztcBIxJkfZwd3ZI+m4wBmaaMAEYqZ0mjON46U+bMfMGiOtumgClNRxfIM5yOEIgzDKINIVIEoYbRsibBu04Qg0DzsbcQBmDbhx54TsASOoa3z98xP2n33H/20f8/OEDfn14wHf3P+Cn97/gx3fv8dfjE9ppQt33aIbhBvWyCGV1R6yV1rDSFPsoRlzXHE2mFNK6RlJVyJqG+0R2wUJEqIYBrTFzhMSqug6xlIzeDKwn6UoYF23HzdgwTegozQV6GKDXCFlQAJGUOAoBVTeo6xpN0+B8PqOqalRVNY/VDfdpzhj61fxQZKThOFKE48gvVdMgTlKEcYwky5CkGWRRIkoSxIQ0Y6zzuuvmyCnqcYS+Es5pGFxTvGmXFFdrsb0AHiP0C9lwIaQJElVrTDw4A+SnOR8GeazrepZBa422nWEGg3UlJqT86QukFT3j4qfnj+4HNOq86NmgKAoG/XbV8UJIInddx1H2HG3HEW2fF9bYJsBYCIGyrJiQUjdm5L55RrhG8Rzb5xKhLApEccKRvkXwGtmFkD56ErttWfTptdxeTPX5AbIQUiGSNEUYxcilnPVsWwZVVakzFFW366B1B6UU681u2Cxw9aEZ4fk+TpaNOE4gRADX8yCCALbt4Hg8Ybc7wHZcxHGM/f4A3xdcYYrM8D7GbYR+EML1fNgOEUUIwgiW4yIMI46c5jxfcBuEIZNT/2jZyPL8Yrm71XeUClWZdNS6R9/PfWrXPs91Hbq+v7xTf+W4IaS0yXtbXd4uylW7/xUlCEIG6Ue7oSxLLghZifpFWUI160mkbtwwV/lGwwm+EExm2TYs28Fuf2AdqVi24+B4OsHzfJ7zRcCp98O8v1+scpqm/IM0zRBFMRzHg+cJZFnOlacx1/X4O5RJSNkEIQ4nC/WyIVhDs2iWqwZCSoRlAXk+IyxLRFUFUUhIpRBVJXyZ85UgzwqiKLhdizFHuCF0ZY4vgcAX4eOYJvCLArs4wifH5r6VZ/gsfPzte1B0UXUa7dC/ZOy5ynRA8t1Ap003nza673EmmwwDemPQLu+rEy53+MU2G0K+yL/RNmuFt+2NbejUdRyX3S/CkE+fPM8hpWTL5LnkIy7NMpRVxbaieWqpmGSv605ZrgCyyX+7PQ60b/cHxsmyeBHa44THp3/guC4vfjge2VL7/ZFdsNl6q21muyR084URRyRlweP0TvahuSiaLUTvNEe3I3nyxjYT20axRehvSdW2SJv5X4NPabct4qqCm2WIyhK11vDyHEldsVw3O2W1jScl2+ZP18Fn38Mfjo3HQLBNHkMBK0vZRk+BwC6O8W8UsnVesQ3YGmSThm7AtkVNh2vX4dz3KOlwXaxDY/Rvjb6L6bqPV8KvDgmruB3WifIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"contents-section\"\n        title=\"\"\n        src=\"/static/8a5eb17d0266b2a8a0a236acc6165474/f058b/contents-section.png\"\n        srcset=\"/static/8a5eb17d0266b2a8a0a236acc6165474/c26ae/contents-section.png 158w,\n/static/8a5eb17d0266b2a8a0a236acc6165474/6bdcf/contents-section.png 315w,\n/static/8a5eb17d0266b2a8a0a236acc6165474/f058b/contents-section.png 630w,\n/static/8a5eb17d0266b2a8a0a236acc6165474/5bb8b/contents-section.png 749w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/80ebc27e539768eb70b8120345c7b000/f3abf/pagination.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.924050632911392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAARElEQVR42n2MQQqAMBAD+/+XehSKaG2SEfGmrIG5JGEaRQ5N+jkgIS+qOKFV4zp2lq0TGfthSsj+F0qm4pZ8u5T/OcUF/77ty3FlZFcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pagination\"\n        title=\"\"\n        src=\"/static/80ebc27e539768eb70b8120345c7b000/f058b/pagination.png\"\n        srcset=\"/static/80ebc27e539768eb70b8120345c7b000/c26ae/pagination.png 158w,\n/static/80ebc27e539768eb70b8120345c7b000/6bdcf/pagination.png 315w,\n/static/80ebc27e539768eb70b8120345c7b000/f058b/pagination.png 630w,\n/static/80ebc27e539768eb70b8120345c7b000/40601/pagination.png 945w,\n/static/80ebc27e539768eb70b8120345c7b000/78612/pagination.png 1260w,\n/static/80ebc27e539768eb70b8120345c7b000/f3abf/pagination.png 1474w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>우리 팀은 data fetching 라이브러리로 react-query를 사용하는데, react-query는 선언적으로 사용되게끔 만들어져있다.</p>\n<p>그래서 명시적으로 api call 을 refetch하는 기능이 있기보다는, useQuery 라는 함수에 넘기는 <strong>key</strong>값이 변경되면 <strong>알아서 data를 fetch/refetch</strong>하는 형식이다.</p>\n<p>그렇다면 useQuery의 refetch가 위에서 말한 <strong>여러가지 조건들에 의존적일 때</strong> 어떻게 다루면 편할까?</p>\n<p>fetch/refetch는 <em>query key값이 변경되면 자동으로 수행</em> 된다고 했다.</p>\n<p>그러면 <strong>query key를 편하고, 전역적으로 다루면 될 것 같다</strong>….</p>\n<p>는 생각에 리로드나 네비게이션간에도 상태가 유지될 수 있고 간편하게 조작할 수 있는 url search params를 활용했다.</p>\n<p><em>검색어</em>가 바뀌거나, 셀렉트 박스의 <em>범죄분야</em>가 바뀌거나, 리스트의 <em>페이지</em>가 바뀌거나, 상담사례인지 해결사례인지 <em>리스트의 타입</em>이 바뀔 때마다 <code class=\"language-text\">?query=something&amp;page=3&amp;listType=column</code> 등으로 search params가 변경되면,</p>\n<p>react-query 의 쿼리들 중 query, page, listType 등의 key값과 매칭되는 value 에 <strong>의존적인 쿼리들</strong>이 자동으로 data를 fetch/refetch* 하게 된다.</p>\n<p>예를 들어 이런 식이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token operator\">**</span><span class=\"token operator\">*</span>useLawyerContents<span class=\"token punctuation\">.</span>tsx<span class=\"token operator\">**</span><span class=\"token operator\">*</span>\n\n<span class=\"token operator\">...</span>\n\n<span class=\"token comment\">// pagination을 다루는 Hook</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> currentPage<span class=\"token punctuation\">,</span> moveTo <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">usePagination</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 변호사 프로필 페이지에서 쓰이는 url searchParams를 핸들링하는 Hook</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> lawyerId<span class=\"token punctuation\">,</span> contentsType<span class=\"token punctuation\">,</span> contentsId<span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> subCategory<span class=\"token punctuation\">,</span>\n setContentsType<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">,</span> setSubCategory<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>rest <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">=</span> <span class=\"token function\">useLawyerProfilePageUrlParam</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 특정 변호사 유저가 작성한 모든 컨텐츠(해결사례, 상담사례)를 불러오는 Query</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> integratedLawyerContentsData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useGetSimpleSearchResultQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// variables 객체를 통해 queryKey를 만든다.</span>\n    <span class=\"token comment\">// -> variables의 키값들이 변경되면 useGetSimpleSearchResultQuery가 재실행된다.</span>\n    variables<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      engineName<span class=\"token operator\">:</span> <span class=\"token constant\">ELASTIC_SEARCH_ENGINE</span><span class=\"token punctuation\">[</span><span class=\"token string\">'integrated-lawyer-contents'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      searchQuery<span class=\"token operator\">:</span> query<span class=\"token punctuation\">,</span>\n      filters<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> lawyer_id<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>lawyerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n      currentPage<span class=\"token operator\">:</span> currentPage <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      size<span class=\"token operator\">:</span> <span class=\"token constant\">LAWYER_PROFILE_PAGE_ENGINE_SIZE</span><span class=\"token punctuation\">[</span><span class=\"token string\">'integrated-lawyer-contents'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      enabled<span class=\"token operator\">:</span> contentsType <span class=\"token operator\">===</span> <span class=\"token constant\">CONTENTS_SECTION_TAB_TYPE</span><span class=\"token punctuation\">[</span><span class=\"token string\">'전체'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> integratedLawyercontentsData<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token operator\">...</span></code></pre></div>\n<h3>결론</h3>\n<p>이미 서버 상태는 react-query에 맡겨둔 상태이니, react-query를 어떻게 편하게 조작할까? 에서 시작된 search params 활용.</p>\n<p>react-query의 data fetch/refetch를 결정하는 **<em>query key</em>**값을 전역 상태인 url search params로 조종함으로써 <a href=\"https://tanstack.com/router/v1/docs/guide/search-params\">위 참조글</a>에서 tanstack-router 가 말한 <strong><em>data-fetching orchestration</em></strong> 를 실무에 간단하게 적용해봤다~</p>","frontmatter":{"title":"URL SearchParams 와 react-query의 편리한 data fetching orchestration","date":"February 28, 2023","description":null}},"previous":{"fields":{"slug":"/2022-03-21-military/"},"frontmatter":{"title":"보충역 병특 구직 및 개발자 면접 후기"}},"next":{"fields":{"slug":"/2024-01-09/"},"frontmatter":{"title":"2024.3에 Web Vital이 될 INP"}}},"pageContext":{"id":"82ca94aa-233e-5d93-b9b8-34b7a2372dff","previousPostId":"6af871b8-5e95-5738-bec6-aeac116a241c","nextPostId":"e4ee26dd-4e0c-5faf-bb0a-66deb4093018"}},"staticQueryHashes":["2744905544","2841359383","3257411868"],"slicesMap":{}}